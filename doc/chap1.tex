% 
% １章 はじめに
%
\chapter{はじめに}

%\section{\cmm の特徴}
\cmml は \cl に似た小さなシステム記述用言語です．
徳山高専教育用 PC(\tac) のシステム記述用言語として開発されました．
\cmml は次に挙げる項目を満たすことを目標に設計されています．
本書は\cl や \javal を学習したことがある人を対象に，
\cmml を紹介するものです．

\begin{description}
\item[「学習が容易な言語であること」]
\cmml は \cl をお手本にしていますが，
\cl の難しい部分を取り去り簡単に理解できるようになっています．
まず，無くても我慢できそうな文法は，思い切り良く省略しています．
例えば，\cl では多次元配列の形式にいくつかのレパートリーがありました．
しかし，\javal にはレパートリーはありません．
\cmml は\javal に倣い多次元配列のレパートリーを認めません．

また，\cl の混乱を招きそうな文法仕様を取り入れないように注意しています．
例えば，\cl の配列は関数に渡されるとポインタとして扱われます．
つまり，関数に渡すと型が変化してしまいます．
このような仕様は，初心者が言語を学習する場合に混乱を招きます．
\cmml では，配列は一貫して参照型として取り扱われます．

その他にも，\cl の難しい文法を取り去る工夫をしてあります．
\javal と似た仕様にすることにより，
\javal でプログラミングの入門をした人が学習しやすくなっています．

\item[「実用的なシステム記述言語であること」]
\cmml は \tac のシステム記述言語として，
\tac の OS や \cmm コンパイラを記述することを目標にしています．
そのため，無闇に文法を簡単化すること無く，
実用的に使用するために必要な文法は残してあります．
例えば，制御文は{\tt if}，{\tt while}，{\tt for}，{\tt do-while}，
{\tt return}，{\tt break}，{\tt continue} 等が一通り準備されています．

また，なるべく効率の良いオブジェクトコードを出力する努力をしています．

\item[「\tac 上で実行可能なこと」]
最終的に \tac 上でセルフ開発環境を構築することを目標としています．
\cmm コンパイラは，セルフ開発環境の中核になるコンポーネントです．
そこで，\cmm コンパイラは \tac の限られた主記憶(64KiB)で実行できるように
メモリを節約するような設計がされています．
コンパイラのプログラムが小さいこともそうですが，
単一の名前表で変数，関数，
構造体を管理する等してデータ構造も小さくするようにしています．

\item[「コンパイラを教材として使用できること」]
\cmm コンパイラは，高専や大学の学生が，
コンパイラの教材として使用することを想定して開発されました．
そのため，コンパイラがコンパクトに記述でき，
コンパイラのソースコードを学生が読めることも目標になっています．

2016年2月現在の \cmm コンパイラは \cl で5,000行程度で記述されています．
5,000行の内訳は，おおよそ，
字句解析部が500行，構文・意味解析部が1,200行，
中間コード生成部が800行，機械語コード生成部が900行，
名前表管理部が200行，構文木管理部が300行，構文木の最適化部が600行です．
少し根気が必要ですが，各モジュールを順に読んでいくことができます．

また，コンパイラの仕組みを理解する手助けにする目的で，
コンパイラ内部で使用される中間コードを出力することもできます．
\cmm コンパイラは入力を中間コードに変換してから，
\tac の機械語に変換します．
中間コードは，
ソースコードからの変換が比較的容易にできる仮想スタックマシンの機械語です．
スタックマシンの機械語を経ることで，
直接\tac の機械語に変換する場合と比較して
コンパイラのアルゴリズムが易しくなっています．

\end{description}
